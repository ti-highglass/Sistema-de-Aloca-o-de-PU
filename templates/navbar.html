<div class="container mx-auto px-4">
    <div class="container-quadrado">
        <nav class="bg-blue-800 shadow-lg rounded-t-3xl">
            <div class="relative flex items-center h-16 px-4">
            <!-- Logo -->
            <div class="flex items-center">
                <img src="{{ url_for('static', filename='img/opera.png') }}" alt="Opera Logo" class="navbar-logo">
            </div>
            
            <!-- Menu desktop centralizado -->
            <div class="hidden md:flex navbar-menu-center">
                {% if current_user and current_user.setor in ['Administrativo', 'T.I'] %}
                <a href="{{ url_for('index') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'index' }}">
                    PCP
                </a>
                {% endif %}
                {% if current_user and current_user.setor != 'Produção' %}
                <a href="http://10.150.16.24:5058/" target="_blank" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200">
                    Etiquetas
                </a>
                {% endif %}
                {% if current_user and current_user.setor in ['Produção', 'Administrativo', 'T.I'] %}
                <a href="{{ url_for('otimizadas') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'otimizadas' }}">
                    Corte-PU
                </a>
                <a href="{{ url_for('estoque') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'estoque' }}">
                    Estoque (Montagem)
                </a>
                <a href="{{ url_for('locais') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'locais' }}">
                    Locais
                </a>

                {% endif %}
                {% if current_user and current_user.setor in ['Administrativo', 'T.I'] %}
                <a href="{{ url_for('arquivos') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'arquivos' }}">
                    Arquivos
                </a>
                {% endif %}

                {% if current_user and current_user.setor == 'T.I' %}
                <a href="{{ url_for('register') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'register' }}">
                    Usuários
                </a>
                {% endif %}
                {% if current_user and current_user.is_authenticated %}
                <a href="{{ url_for('logout') }}" class="navbar-link text-red-400 hover:text-red-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200" title="Sair">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
                {% endif %}
            </div>
            
            <!-- Menu Mobile -->
            <div class="absolute right-4 flex items-center md:hidden">
                <button id="mobile-menu-button" class="text-white hover:text-gray-300 focus:outline-none p-2">
                    <i id="menu-icon" class="fas fa-bars text-xl"></i>
                </button>
            </div>
            </div>
            
            <!-- Menu mobile -->
            <div id="mobile-menu" class="md:hidden absolute top-16 left-0 right-0 bg-blue-700 shadow-lg transform -translate-y-full opacity-0 transition-all duration-300 ease-in-out z-50">
                <div class="px-4 py-3 space-y-2">
                    {% if current_user and current_user.setor in ['Administrativo', 'T.I'] %}
                    <a href="{{ url_for('index') }}" class="text-white hover:bg-blue-600 block px-4 py-3 rounded-md text-base font-medium transition-colors">
                        <i class="fas fa-cogs mr-2"></i>Otimização (PCP)
                    </a>
                    {% endif %}
                    {% if current_user and current_user.setor in ['Produção', 'Administrativo', 'T.I'] %}
                    <a href="{{ url_for('otimizadas') }}" class="text-white hover:bg-blue-600 block px-4 py-3 rounded-md text-base font-medium transition-colors">
                        <i class="fas fa-clock mr-2"></i>Pré-Entrada (Corte)
                    </a>
                    <a href="{{ url_for('estoque') }}" class="text-white hover:bg-blue-600 block px-4 py-3 rounded-md text-base font-medium transition-colors">
                        <i class="fas fa-boxes mr-2"></i>Estoque (Montagem)
                    </a>
                    <a href="{{ url_for('locais') }}" class="text-white hover:bg-blue-600 block px-4 py-3 rounded-md text-base font-medium transition-colors">
                        <i class="fas fa-map-marker-alt mr-2"></i>Locais
                    </a>

                    {% endif %}
                    {% if current_user and current_user.setor in ['Administrativo', 'T.I'] %}
                    <a href="{{ url_for('arquivos') }}" class="text-white hover:bg-blue-600 block px-4 py-3 rounded-md text-base font-medium transition-colors">
                        <i class="fas fa-file-alt mr-2"></i>Arquivos
                    </a>
                    {% endif %}
                    {% if current_user and current_user.setor != 'Produção' %}
                    <a href="http://10.150.16.24:5058/" target="_blank" class="text-white hover:bg-blue-600 block px-4 py-3 rounded-md text-base font-medium transition-colors">
                        <i class="fas fa-tags mr-2"></i>Etiquetas
                    </a>
                    {% endif %}
                    {% if current_user and current_user.setor == 'T.I' %}
                    <a href="{{ url_for('register') }}" class="text-white hover:bg-blue-600 block px-4 py-3 rounded-md text-base font-medium transition-colors">
                        <i class="fas fa-user-plus mr-2"></i>Cadastrar
                    </a>
                    {% endif %}
                    {% if current_user and current_user.is_authenticated %}
                    <div class="border-t border-blue-600 pt-2 mt-2">
                        <a href="{{ url_for('logout') }}" class="text-red-300 hover:bg-red-600 hover:text-white block px-4 py-3 rounded-md text-base font-medium transition-colors">
                            <i class="fas fa-power-off mr-2"></i>Sair
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </nav>
    </div>
</div>

<!-- Adicionar setor do usuário ao body para proteção de URL -->
<script>
{% if current_user and current_user.is_authenticated %}
document.body.dataset.userSector = '{{ current_user.setor }}';
{% endif %}

document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    let isMenuOpen = false;
    
    if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function() {
            isMenuOpen = !isMenuOpen;
            
            if (isMenuOpen) {
                mobileMenu.classList.remove('-translate-y-full', 'opacity-0');
                mobileMenu.classList.add('translate-y-0', 'opacity-100');
                menuIcon.classList.remove('fa-bars');
                menuIcon.classList.add('fa-times');
            } else {
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                mobileMenu.classList.add('-translate-y-full', 'opacity-0');
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            }
        });
        
        // Fechar menu ao clicar em um link
        const menuLinks = mobileMenu.querySelectorAll('a');
        menuLinks.forEach(link => {
            link.addEventListener('click', () => {
                isMenuOpen = false;
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                mobileMenu.classList.add('-translate-y-full', 'opacity-0');
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            });
        });
    }
});
</script>

<!-- Sistema de logout automático -->
<script src="{{ url_for('static', filename='js/session.js') }}"></script>
<!-- Proteção contra manipulação de URL -->
<script src="{{ url_for('static', filename='js/url-protection.js') }}"></script>